---
title: "Homework_4"
author: "Rebecca Cheek"
date: "October 24, 2018"
output: html_document
---

```{r}
knitr::opts_chunk$set(echo= TRUE)

library(tidyr)
library(dplyr)
library(ggplot2)
library(broom)
library(purrr)
library(knitr)

```


List files in the subdirectory
```{r}
list.files("../data")
```

load data

```{r}
homicides <- read_csv("https://github.com/washingtonpost/data-homicides/raw/master/homicide-data.csv")

##Join city and state collumns
homicides <- homicides %>% 
  unite(city_name, c("city", "state"), sep= ",") %>% 
  group_by(city_name) %>% 
  count(disposition)

# Create a dataframe called 'unsolved' with one row per city that gives the total number #of homicides for the city and the number of unsolved homicides (those for which the #disposition is “Closed without arrest” or “Open/No arrest”) 

unsolved <- spread(homicides, key = disposition, value = n) 
  
unsolved$unsolved <- rowSums(unsolved[,c("Closed without arrest","Open/No arrest")], na.rm=TRUE) 
  
  
unsolved <- unsolved %>% 
  select("city_name", "Closed by arrest", "unsolved")

#For the city of Baltimore, MD, use the prop.test function to estimate the proportion of homicides that are unsolved, as well as the 95% confidence interval for this proportion. Print the output of the prop.test directly in your RMarkdown, and then save the output of prop.test as an R object and apply the tidy function from the broom package to this object and pull the estimated proportion and confidence intervals from the resulting tidy dataframe.

baltimore <- unsolved %>% 
  subset(city_name == "Baltimore,MD") 

##output is dbl and causign problems, so try to force covert the resulting collums before prop.test
baltimore$n_cases <- rowSums(baltimore[,c("Closed by arrest","unsolved")]) 


baltimore_prop <- prop.test(1825,2827, conf.level=0.95) %>% 
  tidy(baltimore_prop) %>% 
print(baltimore_prop)

unsolved$n_cases <- rowSums(unsolved[,c("Closed by arrest","unsolved")])

homicide_sum <- unsolved %>% 
  rowwise() %>% 
  mutate(test=list(broom::tidy(prop.test(unsolved, n_cases, conf.level=0.95)))) %>% 
           tidyr::unnest(test)
         
                                         

```

